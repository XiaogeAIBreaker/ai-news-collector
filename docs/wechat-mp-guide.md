# 微信公众号文章采集使用指南

## 📋 功能概述

本系统支持通过微信公众号后台接口采集指定公众号的文章,具有以下特点:

### ✨ 核心优势

1. **零配置** - 通过二维码扫码自动登录,无需手动获取任何参数
2. **自动化** - Token 自动管理和过期刷新,登录一次长期有效(约7天)
3. **稳定可靠** - 使用微信官方后台接口,相比传统抓包方式更稳定
4. **多公众号支持** - 可同时配置采集多个公众号
5. **智能频率控制** - 自动控制请求频率,避免被限流

### 🆚 与传统方案对比

| 特性 | 传统抓包方案 | 手动配置方案 | **本方案(二维码登录)** |
|------|------------|------------|---------------------|
| 配置复杂度 | 高(需要抓包技能) | 中(需要手动复制) | **低(扫码即可)** |
| Token 管理 | 需手动更新 | 需手动更新 | **自动管理** |
| Token 有效期 | ~1-2小时 | ~数天 | ~7天 |
| 使用门槛 | 技术门槛高 | 需要后台操作 | **类似微信网页版** |
| 稳定性 | 中 | 高 | 高 |

---

## 🚀 快速开始

### 前提条件

1. **微信公众号账号**:需要拥有一个微信公众号(个人订阅号即可,无需认证)
   - 如果还没有,可以前往 [微信公众平台](https://mp.weixin.qq.com/) 免费注册
   - 注册个人订阅号非常简单,只需要实名认证即可

2. **Node.js 环境**: Node.js >= 18.0.0

### 使用步骤

#### 步骤 1: 首次运行(自动登录)

```bash
npm start
```

首次运行时,程序会自动显示二维码:

```
=== 微信公众号登录 ===
请使用微信扫一扫功能扫描以下二维码:

█████████████████████████████
█████████████████████████████
███  ...二维码图案...   ███
█████████████████████████████
█████████████████████████████

等待扫码中...
```

**操作**:
1. 打开微信
2. 点击右上角 "+" → "扫一扫"
3. 扫描终端中的二维码
4. 在手机上确认登录

**登录成功后**:
- Token 自动保存到 `.wechat-token.json` 文件
- 下次运行时无需重新登录(Token 有效期约7天)
- Token 过期时会自动提示重新扫码

#### 步骤 2: 配置要采集的公众号

编辑 `src/config/datasources.js`,在 `WECHAT_MP_CONFIG.config.accounts` 中添加公众号:

```javascript
export const WECHAT_MP_CONFIG = {
  name: 'WeChat-MP',
  // ...
  config: {
    accounts: [
      {
        fakeid: 'MzI1NjIyMTAwMA==',  // 公众号 ID
        nickname: 'AI科技评论',        // 公众号名称
        enabled: true                  // 是否启用
      },
      {
        fakeid: 'MzUxOTU3NjE4MA==',
        nickname: '量子位',
        enabled: true
      }
      // 可以继续添加更多公众号
    ]
  }
};
```

#### 步骤 3: 获取公众号的 Fakeid

**方法一: 通过公众号后台搜索**

1. 登录公众号后台 [mp.weixin.qq.com](https://mp.weixin.qq.com)
2. 左侧菜单 → "新建图文消息" 或 "素材管理"
3. 在编辑器中,点击 "超链接" → "文章链接"
4. 搜索你要采集的公众号名称
5. 打开浏览器开发者工具(F12) → Network 标签页
6. 在搜索结果中看到请求,查找 URL 参数中的 `fakeid`
7. 复制 fakeid 值到配置文件

**方法二: 常见 AI 公众号 Fakeid 列表**

| 公众号名称 | Fakeid (示例) |
|----------|--------------|
| AI科技评论 | MzI1NjIyMTAwMA== |
| 量子位 | MzUxOTU3NjE4MA== |
| 机器之心 | MzA5NzM5ODcyNg== |
| 新智元 | MzI1ODYzOTYzNA== |

> 注意:以上 Fakeid 仅为示例,请根据实际情况获取

#### 步骤 4: 运行采集

```bash
npm start
```

程序会自动:
1. 检测 token 是否有效(有效则直接使用,无效则提示扫码)
2. 依次采集配置的每个公众号
3. 对文章进行 LLM 评分和过滤
4. 输出到 Markdown 文件

**示例输出**:
```
✅ 加载已保存的 Token (剩余有效期: 5 天)

正在采集: WeChat-MP
[1/2] 采集公众号: AI科技评论
✅ AI科技评论: 获取 15 条文章
⏳ 等待 4.2 秒后继续...
[2/2] 采集公众号: 量子位
✅ 量子位: 获取 12 条文章
采集完成,共获取 27 条文章 (耗时: 12.5s)
```

---

## 🔧 配置说明

### 数据源配置

在 `src/config/datasources.js` 中的 `WECHAT_MP_CONFIG`:

```javascript
export const WECHAT_MP_CONFIG = {
  enabled: true,         // 是否启用微信数据源
  maxItems: 20,          // 每个公众号最多采集文章数
  timeout: 30000,        // 请求超时时间(毫秒)
  config: {
    accounts: [
      // 公众号列表
    ],
    rateLimit: {
      minDelay: 3000,    // 最小延迟(毫秒)
      maxDelay: 5000     // 最大延迟(毫秒)
    }
  }
};
```

### 公众号配置

每个公众号配置包含:
- `fakeid` (必需): 公众号唯一 ID
- `nickname` (必需): 公众号名称,用于日志和文章来源标识
- `enabled` (可选): 是否启用该公众号,默认 `true`

---

## ❓ 常见问题

### Q1: 二维码无法显示怎么办?

**终端显示失败时**:
- 程序会自动在浏览器中打开二维码 HTML 页面
- 如果浏览器也未自动打开,会显示 HTML 文件路径
- 手动打开该 HTML 文件即可看到二维码

**如果都失败**:
- 程序会输出二维码 URL
- 可以访问该 URL 或使用在线二维码生成工具

### Q2: Token 过期怎么办?

**自动处理**:
- 系统会自动检测 token 过期(响应码 ret=200003)
- 自动显示二维码提示重新登录
- 登录成功后自动继续采集
- **无需重启程序或手动操作**

**手动处理**:
- 删除 `.wechat-token.json` 文件
- 重新运行程序
- 扫码登录

### Q3: 如何找到目标公众号的 Fakeid?

见上文"步骤 3: 获取公众号的 Fakeid"部分。

最简单的方法:
1. 登录你的公众号后台
2. 进入"新建图文消息"编辑器
3. 点击"超链接" → "文章链接"
4. 搜索目标公众号
5. F12 查看 Network 请求中的 `fakeid` 参数

### Q4: 是否需要认证公众号?

**不需要!**
- 个人订阅号(未认证)即可使用
- 不需要支付任何费用
- 注册即可使用

### Q5: 可以采集多少个公众号?

**技术上无限制**,但建议:
- 不超过 **10 个**公众号,避免采集时间过长
- 可以通过 `enabled: false` 临时禁用某些公众号
- 合理设置 `maxItems` 控制每个公众号的采集数量

### Q6: Token 会不会泄露?

**安全措施**:
- ✅ Token 存储在本地 `.wechat-token.json` 文件
- ✅ 文件已加入 `.gitignore`,不会提交到 Git
- ✅ 文件权限设置为 600(仅当前用户可读写)
- ✅ Token 仅在本地使用,不上传到任何服务器

**注意事项**:
- ⚠️  不要将 `.wechat-token.json` 文件分享给他人
- ⚠️  如果token泄露,可以删除文件并重新登录
- ⚠️  建议使用个人测试公众号,不要使用重要公众号

### Q7: 采集会被封号吗?

**风险很低**,因为:
- 使用的是微信官方后台接口,不是爬虫
- 实现了适当的频率控制(3-5秒延迟)
- 每个公众号采集数量有限(默认20篇)

**建议**:
- ✅ 使用个人订阅号(小号)进行采集
- ✅ 不要频繁采集同一个公众号
- ✅ 合理设置采集间隔和数量
- ⚠️  不要用于大规模商业化采集

---

## 🎯 使用技巧

### 1. 批量配置公众号

```javascript
const aiAccounts = [
  { fakeid: 'xxx1', nickname: 'AI科技评论', enabled: true },
  { fakeid: 'xxx2', nickname: '量子位', enabled: true },
  { fakeid: 'xxx3', nickname: '机器之心', enabled: true },
  { fakeid: 'xxx4', nickname: '新智元', enabled: false }, // 暂时禁用
];

export const WECHAT_MP_CONFIG = {
  // ...
  config: {
    accounts: aiAccounts
  }
};
```

### 2. 调整采集频率

```javascript
config: {
  rateLimit: {
    minDelay: 5000,  // 增加到 5-8 秒,更保守
    maxDelay: 8000
  }
}
```

### 3. 限制采集数量

```javascript
export const WECHAT_MP_CONFIG = {
  maxItems: 10,  // 每个公众号只采集最新 10 篇
};
```

### 4. 查看 Token 信息

```bash
cat .wechat-token.json
```

输出示例:
```json
{
  "token": "1234567890",
  "cookie": "...",
  "nickname": "",
  "expires_at": "2024-01-08T12:00:00.000Z",
  "created_at": "2024-01-01T12:00:00.000Z"
}
```

---

## ⚠️  免责声明

1. **仅供学习研究使用**,请勿用于商业用途或大规模数据采集
2. 使用前请确保符合微信平台服务条款
3. 建议在采集他人内容前获得授权
4. 本工具作者不对使用本工具产生的任何后果负责
5. 请合理使用,避免对微信服务器造成过大压力

---

## 📞 技术支持

遇到问题可以:
1. 查看日志输出,了解详细错误信息
2. 检查网络连接是否正常
3. 确认公众号账号可以正常登录后台
4. 查看项目 GitHub Issues

---

## 🎉 开始使用

现在你已经了解了所有必要信息,可以开始使用微信公众号文章采集功能了!

```bash
# 1. 首次运行,扫码登录
npm start

# 2. 配置公众号 Fakeid
# 编辑 src/config/datasources.js

# 3. 再次运行,开始采集
npm start
```

祝你使用愉快! 🎊
