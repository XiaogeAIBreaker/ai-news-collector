# 实现任务清单

## 1. 配置和环境准备
- [x] 1.1 在 `.env.example` 添加 `ZSXQ_COOKIE` 配置说明
- [x] 1.2 在 `src/config/datasources.js` 添加 `ZSXQ_CONFIG` 配置对象
  - 包含星球列表配置 (星球 ID + 标签列表)
  - 包含通用配置 (enabled, maxItems, timeout)
- [x] 1.3 更新 `getEnabledDataSources()` 函数包含知识星球配置

## 2. 知识星球采集器实现
- [x] 2.1 创建 `src/collectors/zsxq.js` 文件
- [x] 2.2 实现 `ZSXQCollector` 类继承 `BaseCollector`
- [x] 2.3 实现 `collect()` 主方法
  - 循环处理所有配置的星球
  - 对每个星球,循环处理配置的标签
- [x] 2.4 实现 HTTP 请求方法 `fetchGroupTopics(groupId, tagId)`
  - 构建知识星球 API 请求 (基于网页接口)
  - 添加 Cookie 认证头
  - 处理分页(如果需要)
- [x] 2.5 实现内容解析方法 `parseTopics(data)`
  - 提取帖子 ID、标题、内容、作者、时间
  - 提取互动数据(点赞、评论数)
  - 处理富文本内容(去除 HTML 标签)
- [x] 2.6 实现内容去重逻辑
  - 使用帖子 ID 或 URL 作为唯一标识
  - 跨标签去重避免重复内容
- [x] 2.7 实现错误处理
  - Cookie 失效检测
  - 权限不足检测
  - 网络错误重试

## 3. 数据模型适配
- [x] 3.1 验证 `NewsItem` 模型是否满足知识星球内容需求
- [x] 3.2 实现知识星球数据到 `NewsItem` 的转换
  - title: 帖子标题或内容前 100 字符
  - summary: 内容摘要(最多 500 字符)
  - url: 知识星球帖子链接
  - source: "知识星球-{星球名称}"
  - createdAt: 发布时间
- [x] 3.3 添加元数据字段(如果 NewsItem 支持扩展)
  - 点赞数、评论数、作者信息

## 4. 主流程集成
- [x] 4.1 修改 `src/index.js` 支持多数据源
  - 导入 `ZSXQCollector`
  - 循环调用所有启用的数据源采集器
  - 合并所有数据源的采集结果
- [x] 4.2 验证 LLM 评分流程支持混合数据源
  - 确认 Orchestrator 可以处理来自不同数据源的内容
  - 测试评分和过滤逻辑的正确性

## 5. 输出格式优化
- [x] 5.1 修改 `src/output/markdown.js` 支持按数据源分组
  - 在报告中添加数据源分组标题
  - 统计各数据源的采集和过滤数量
- [x] 5.2 更新报告模板显示多数据源信息
  - 总采集数按数据源分解
  - 过滤后数量按数据源分解

## 6. 测试和验证
- [x] 6.1 手动测试知识星球采集功能
  - 配置测试星球和标签
  - 验证能够成功采集内容
  - 验证 Cookie 认证正常工作
- [x] 6.2 测试错误场景
  - 测试 Cookie 失效时的行为
  - 测试网络错误时的重试
  - 测试权限不足时的处理
- [x] 6.3 测试多数据源混合场景
  - 同时启用 AIBase 和知识星球
  - 验证内容正确合并和评分
  - 验证报告正确分组显示
- [x] 6.4 端到端测试
  - 运行完整流程
  - 检查生成的 Markdown 报告
  - 验证成本和性能符合预期

## 7. 文档更新
- [x] 7.1 更新 `README.md`
  - 添加知识星球数据源说明
  - 添加 Cookie 获取和配置指南
  - 更新配置示例
- [x] 7.2 更新 `openspec/project.md` (如果需要)
  - 添加知识星球相关的领域知识
  - 更新外部依赖说明

## 8. 代码质量
- [x] 8.1 代码审查
  - 检查命名规范
  - 确保中文注释覆盖关键逻辑
  - 验证错误处理完整性
- [x] 8.2 性能优化
  - 确认重试机制合理
  - 验证内存使用正常
  - 检查并发控制(如果有多个星球)

## 依赖关系说明
- 任务 2 依赖任务 1 (需要先有配置)
- 任务 3 依赖任务 2 (需要先解析数据)
- 任务 4 依赖任务 2 和 3 (需要采集器和数据模型就绪)
- 任务 5 依赖任务 4 (需要数据流通后再优化输出)
- 任务 6 依赖任务 1-5 (需要所有功能完成后测试)
- 任务 7 和 8 可以在任务 6 完成后并行进行

## 可并行执行的任务
- 任务 1.1, 1.2, 1.3 可以并行
- 任务 2.4, 2.5 可以并行开发(使用 mock 数据测试)
- 任务 7.1, 7.2, 8.1, 8.2 可以并行
